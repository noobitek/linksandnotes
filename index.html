


    
    
    لینک‌های مفید من
    
    
    
    
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap');
        body {
            background: linear-gradient(to bottom right, #1e293b, #2d3748);
            min-height: 100vh;
            font-family: 'Vazirmatn', sans-serif;
            color: #e2e8f0;
        }
        .link-card {
            background: #2d3748;
            border: 1px solid #4b5563;
            transition: transform 0.3s ease, box-shadow 0.3s ease, background 0.3s ease;
            cursor: pointer;
            position: relative;
            padding-top: 20px;
            padding-left: 40px;
            padding-right: 24px;
            padding-bottom: 12px;
        }
        .link-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            background: #3b4a6b;
        }
        .form-container {
            background: #2d3748;
            border: 1px solid #4b5563;
            transition: box-shadow 0.3s ease;
        }
        .form-container:hover {
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }
        input, select, textarea {
            background: #1e293b;
            border: 1px solid #4b5563;
            color: #e2e8f0;
        }
        input:focus, select:focus, textarea:focus {
            border-color: #6366f1;
            outline: none;
            ring: 2px #6366f1;
        }
        button {
            transition: background 0.3s ease;
        }
        button:hover {
            background: #4f46e5;
        }
        .delete-btn {
            transition: color 0.3s ease;
            font-size: 1.5rem;
        }
        .delete-btn:hover {
            color: #ef4444;
        }
        .notes-text {
            color: #94a3b8;
            word-break: break-word;
            overflow-wrap: break-word;
            max-height: 60px;
        }
        .notes-text.scrollable {
            overflow-y: auto;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 50;
            align-items: center;
            justify-content: center;
        }
        .modal.show {
            display: flex;
        }
        .notes-display {
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
            background: #1e293b;
            border-radius: 8px;
            color: #e2e8f0;
        }
        #notes-modal .form-container {
            max-width: 600px;
            width: 90%;
        }
        .icon-group {
            position: absolute;
            top: 0px;
            left: 10px;
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 5px;
        }
        .edit-icon {
            cursor: pointer;
            color: #94a3b8;
            transition: color 0.3s ease;
        }
        .edit-icon:hover {
            color: #6366f1;
        }
        .link-card h3 {
            word-break: break-word;
            overflow-wrap: break-word;
            overflow: hidden;
        }
    


    
        لینک‌های مفید من
        مجموعه‌ای از منابع مورد علاقه من
    
    
        
            ورود / ثبت‌نام
            
                
                
                
                    ورود
                    ثبت‌نام
                    خروج
                
            
        
    
    
        
        جستجو
    
    
        افزودن لینک جدید
    
    
        
            افزودن لینک جدید
            
                
                
                
                    انتخاب دسته‌بندی
                
                
                
                
                    افزودن لینک
                    لغو
                
            
        
    
    
        
            
            
            
                ذخیره یادداشت‌ها
                بستن
            
        
    
    
        
            تایید حذف
            آیا مطمئن هستید که می‌خواهید این لینک را حذف کنید؟
            
                حذف
                لغو
            
        
    
    
    
    
        const supabaseUrl = 'https://mmtbzcorylzlomlacfvg.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1tdGJ6Y29yeWx6bG9tbGFjZnZnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI5OTI0NzcsImV4cCI6MjA2ODU2ODQ3N30.uqvMRuot0I-iRmwIO7GSfp4bqqUBrZcjjV5ExHlN0pk';
        const supabase = supabase.createClient(supabaseUrl, supabaseKey);

<pre><code>    let links = [];
    let categories = [];
    const defaultCategories = [&quot;یادداشتها&quot;, &quot;عمومی&quot;, &quot;کاری&quot;, &quot;شخصی&quot;];
    const linkContainer = document.getElementById(&#39;link-container&#39;);
    const titleInput = document.getElementById(&#39;link-title&#39;);
    const urlInput = document.getElementById(&#39;link-url&#39;);
    const categorySelect = document.getElementById(&#39;link-category&#39;);
    const newCategoryInput = document.getElementById(&#39;new-category&#39;);
    const notesInput = document.getElementById(&#39;link-notes&#39;);
    const addLinkButton = document.getElementById(&#39;add-link&#39;);
    const showFormButton = document.getElementById(&#39;show-form-btn&#39;);
    const cancelFormButton = document.getElementById(&#39;cancel-form&#39;);
    const formModal = document.getElementById(&#39;form-modal&#39;);
    const formModalTitle = document.getElementById(&#39;form-modal-title&#39;);
    const searchInput = document.getElementById(&#39;search-input&#39;);
    const searchButton = document.getElementById(&#39;search-btn&#39;);
    const notesModal = document.getElementById(&#39;notes-modal&#39;);
    const notesModalTitle = document.getElementById(&#39;notes-modal-title&#39;);
    const notesModalContent = document.getElementById(&#39;notes-modal-content&#39;);
    const closeNotesModalButton = document.getElementById(&#39;close-notes-modal&#39;);
    const saveNotesModalButton = document.getElementById(&#39;save-notes-modal&#39;);
    const confirmModal = document.getElementById(&#39;confirm-modal&#39;);
    const confirmDeleteBtn = document.getElementById(&#39;confirm-delete-btn&#39;);
    const cancelDeleteBtn = document.getElementById(&#39;cancel-delete-btn&#39;);
    const emailInput = document.getElementById(&#39;email&#39;);
    const passwordInput = document.getElementById(&#39;password&#39;);
    const signInBtn = document.getElementById(&#39;sign-in-btn&#39;);
    const signUpBtn = document.getElementById(&#39;sign-up-btn&#39;);
    const signOutBtn = document.getElementById(&#39;sign-out-btn&#39;);
    const authContainer = document.getElementById(&#39;auth-container&#39;);

    let currentLinkIndex = -1;
    let isEditMode = false;

    async function ensureDefaultCategories() {
        const { data: existingCategories, error } = await supabase
            .from(&#39;categories&#39;)
            .select(&#39;name&#39;)
            .eq(&#39;user_id&#39;, (await supabase.auth.getUser()).data.user.id);
        if (error) {
            showMessageBox(`خطا در بررسی دسته‌بندی‌ها: ${error.message}`, &#39;error&#39;);
            return;
        }
        const existingCategoryNames = existingCategories ? existingCategories.map(cat =&gt; cat.name) : [];
        const missingCategories = defaultCategories.filter(cat =&gt; !existingCategoryNames.includes(cat));
        if (missingCategories.length &gt; 0) {
            const { error: insertError } = await supabase
                .from(&#39;categories&#39;)
                .insert(
                    missingCategories.map(name =&gt; ({
                        name,
                        user_id: (await supabase.auth.getUser()).data.user.id
                    }))
                );
            if (insertError) {
                showMessageBox(`خطا در افزودن دسته‌بندی‌های پیش‌فرض: ${insertError.message}`, &#39;error&#39;);
            }
        }
    }

    supabase.auth.getSession().then(async ({ data: { session } }) =&gt; {
        if (session) {
            signInBtn.classList.add(&#39;hidden&#39;);
            signUpBtn.classList.add(&#39;hidden&#39;);
            signOutBtn.classList.remove(&#39;hidden&#39;);
            authContainer.classList.add(&#39;hidden&#39;);
            await ensureDefaultCategories();
            renderCategories();
            renderLinks();
            supabase
                .channel(&#39;links&#39;)
                .on(&#39;postgres_changes&#39;, { event: &#39;*&#39;, schema: &#39;public&#39;, table: &#39;links&#39;, filter: `user_id=eq.${session.user.id}` }, payload =&gt; {
                    renderLinks(searchInput.value);
                })
                .subscribe();
        }
    });

    signUpBtn.addEventListener(&#39;click&#39;, async () =&gt; {
        const email = emailInput.value.trim();
        const password = passwordInput.value.trim();
        if (!email || !password) {
            showMessageBox(&#39;لطفاً ایمیل و رمز عبور را وارد کنید.&#39;, &#39;error&#39;);
            return;
        }
        const { error } = await supabase.auth.signUp({ email, password });
        if (error) {
            showMessageBox(`خطا در ثبت‌نام: ${error.message}`, &#39;error&#39;);
        } else {
            showMessageBox(&#39;ثبت‌نام موفق! لطفاً ایمیل خود را تأیید کنید.&#39;, &#39;success&#39;);
            await ensureDefaultCategories();
            renderCategories();
        }
    });

    signInBtn.addEventListener(&#39;click&#39;, async () =&gt; {
        const email = emailInput.value.trim();
        const password = passwordInput.value.trim();
        if (!email || !password) {
            showMessageBox(&#39;لطفاً ایمیل و رمز عبور را وارد کنید.&#39;, &#39;error&#39;);
            return;
        }
        const { error } = await supabase.auth.signInWithPassword({ email, password });
        if (error) {
            showMessageBox(`خطا در ورود: ${error.message}`, &#39;error&#39;);
        } else {
            showMessageBox(&#39;ورود موفق!&#39;, &#39;success&#39;);
            signInBtn.classList.add(&#39;hidden&#39;);
            signUpBtn.classList.add(&#39;hidden&#39;);
            signOutBtn.classList.remove(&#39;hidden&#39;);
            authContainer.classList.add(&#39;hidden&#39;);
            await ensureDefaultCategories();
            renderCategories();
            renderLinks();
        }
    });

    signOutBtn.addEventListener(&#39;click&#39;, async () =&gt; {
        const { error } = await supabase.auth.signOut();
        if (error) {
            showMessageBox(`خطا در خروج: ${error.message}`, &#39;error&#39;);
        } else {
            showMessageBox(&#39;با موفقیت خارج شدید!&#39;, &#39;success&#39;);
            signInBtn.classList.remove(&#39;hidden&#39;);
            signUpBtn.classList.remove(&#39;hidden&#39;);
            signOutBtn.classList.add(&#39;hidden&#39;);
            authContainer.classList.remove(&#39;hidden&#39;);
            linkContainer.innerHTML = &#39;&#39;;
            categories = [];
            categorySelect.innerHTML = &#39;&lt;option value=&quot;&quot;&gt;انتخاب دسته‌بندی&lt;/option&gt;&#39;;
        }
    });

    async function renderCategories() {
        categorySelect.innerHTML = &#39;&lt;option value=&quot;&quot;&gt;انتخاب دسته‌بندی&lt;/option&gt;&#39;;
        const { data, error } = await supabase
            .from(&#39;categories&#39;)
            .select(&#39;name&#39;)
            .eq(&#39;user_id&#39;, (await supabase.auth.getUser()).data.user.id)
            .order(&#39;name&#39;, { ascending: true });
        if (error) {
            showMessageBox(`خطا در بارگذاری دسته‌بندی‌ها: ${error.message}`, &#39;error&#39;);
            return;
        }
        categories = data ? data.map(cat =&gt; cat.name) : [];
        categories.forEach(category =&gt; {
            const option = document.createElement(&#39;option&#39;);
            option.value = category;
            option.textContent = category;
            categorySelect.appendChild(option);
        });
    }

    async function renderLinks(searchTerm = &#39;&#39;) {
        linkContainer.innerHTML = &#39;&#39;;
        const { data, error } = await supabase
            .from(&#39;links&#39;)
            .select(&#39;*&#39;)
            .eq(&#39;user_id&#39;, (await supabase.auth.getUser()).data.user.id)
            .order(&#39;created_at&#39;, { ascending: false });
        if (error) {
            showMessageBox(`خطا در بارگذاری لینک‌ها: ${error.message}`, &#39;error&#39;);
            return;
        }
        links = data || [];
        const filteredLinks = searchTerm
            ? links.filter(link =&gt; 
                link.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
                (link.url &amp;&amp; link.url.toLowerCase().includes(searchTerm.toLowerCase())) ||
                (link.notes &amp;&amp; link.notes.toLowerCase().includes(searchTerm.toLowerCase())) ||
                link.category.toLowerCase().includes(searchTerm.toLowerCase())
            )
            : links;

        categories.forEach(category =&gt; {
            const categoryLinks = filteredLinks.filter(link =&gt; link.category === category);
            if (categoryLinks.length &gt; 0) {
                const categoryDiv = document.createElement(&#39;div&#39;);
                categoryDiv.className = &#39;flex flex-col gap-4&#39;;
                categoryDiv.innerHTML = `&lt;h2 class=&quot;text-2xl font-semibold text-white&quot;&gt;${category}&lt;/h2&gt;`;
                categoryLinks.forEach((link, index) =&gt; {
                    const linkElement = document.createElement(&#39;div&#39;);
                    linkElement.className = &#39;link-card rounded-lg shadow-md hover:shadow-lg flex justify-between items-start&#39;;
                    linkElement.dataset.title = link.title;
                    linkElement.dataset.url = link.url || &#39;&#39;;
                    linkElement.dataset.notes = link.notes || &#39;&#39;;
                    linkElement.dataset.index = links.indexOf(link);
                    linkElement.dataset.id = link.id;

                    const notesParagraph = link.notes ? `&lt;p class=&quot;text-sm notes-text mt-2&quot;&gt;${link.notes}&lt;/p&gt;` : &#39;&#39;;
                    const displayedTitle = link.title.length &gt; 25 ? link.title.substring(0, 25) + &#39;...&#39; : link.title;

                    const editIconHtml = `
                        &lt;i class=&quot;fa-solid fa-pencil edit-icon&quot; data-index=&quot;${links.indexOf(link)}&quot;&gt;&lt;/i&gt;
                    `;

                    linkElement.innerHTML = `
                        &lt;div class=&quot;icon-group&quot;&gt;
                            &lt;button class=&quot;delete-btn text-gray-300 hover:text-red-500&quot; data-index=&quot;${links.indexOf(link)}&quot; data-category=&quot;${category}&quot; data-id=&quot;${link.id}&quot;&gt;×&lt;/button&gt;
                            ${editIconHtml}
                        &lt;/div&gt;
                        &lt;div class=&quot;flex-1&quot;&gt;
                            &lt;a href=&quot;${link.url || &#39;#&#39;}&quot; class=&quot;block&quot; ${link.url ? &#39;onclick=&quot;event.preventDefault();&quot;&#39; : &#39;&#39;}&gt;
                                &lt;h3 class=&quot;text-lg font-medium text-white&quot;&gt;${displayedTitle}&lt;/h3&gt;
                            &lt;/a&gt;
                            ${notesParagraph}
                        &lt;/div&gt;
                    `;
                    categoryDiv.appendChild(linkElement);

                    if (link.notes &amp;&amp; link.notes.length &gt; 160) {
                        const pElement = linkElement.querySelector(&#39;.notes-text&#39;);
                        if (pElement) {
                            pElement.classList.add(&#39;scrollable&#39;);
                        }
                    }
                });
                linkContainer.appendChild(categoryDiv);
            }
        });

        document.querySelectorAll(&#39;.delete-btn&#39;).forEach(button =&gt; {
            button.addEventListener(&#39;click&#39;, (e) =&gt; {
                e.stopPropagation();
                const indexToDelete = parseInt(e.target.dataset.index);
                currentLinkIndex = indexToDelete;
                confirmModal.classList.add(&#39;show&#39;);
            });
        });

        document.querySelectorAll(&#39;.link-card&#39;).forEach(card =&gt; {
            card.addEventListener(&#39;click&#39;, (e) =&gt; {
                const url = e.currentTarget.dataset.url;
                const title = e.currentTarget.dataset.title;
                const notes = e.currentTarget.dataset.notes;
                currentLinkIndex = parseInt(e.currentTarget.dataset.index);

                if (!url &amp;&amp; notes &amp;&amp; !e.target.closest(&#39;.edit-icon&#39;)) {
                    notesModalTitle.textContent = title;
                    notesModalContent.value = notes;
                    notesModal.classList.add(&#39;show&#39;);
                } else if (url &amp;&amp; !e.target.closest(&#39;.edit-icon&#39;)) {
                    window.open(url, &#39;_blank&#39;);
                }
            });
        });

        document.querySelectorAll(&#39;.edit-icon&#39;).forEach(icon =&gt; {
            icon.addEventListener(&#39;click&#39;, (e) =&gt; {
                e.stopPropagation();
                const index = parseInt(e.currentTarget.dataset.index);
                const link = links[index];

                isEditMode = true;
                currentLinkIndex = index;

                formModalTitle.textContent = &#39;ویرایش لینک&#39;;
                addLinkButton.textContent = &#39;ذخیره تغییرات&#39;;

                titleInput.value = link.title;
                urlInput.value = link.url || &#39;&#39;;
                categorySelect.value = link.category;
                newCategoryInput.value = &#39;&#39;;
                notesInput.value = link.notes || &#39;&#39;;

                formModal.classList.add(&#39;show&#39;);
            });
        });
    }

    addLinkButton.addEventListener(&#39;click&#39;, async () =&gt; {
        let title = titleInput.value.trim();
        const url = urlInput.value.trim();
        let category = categorySelect.value;
        const newCategory = newCategoryInput.value.trim();
        const notes = notesInput.value.trim();

        if (title.length &gt; 25) {
            title = title.substring(0, 25);
            showMessageBox(&#39;عنوان به 25 کاراکتر محدود شد.&#39;, &#39;info&#39;);
        }

        if (!title) {
            showMessageBox(&#39;لطفاً عنوان لینک را وارد کنید.&#39;, &#39;error&#39;);
            return;
        }

        if (newCategory) {
            category = newCategory;
            if (!categories.includes(newCategory)) {
                const { error } = await supabase
                    .from(&#39;categories&#39;)
                    .insert([
                        { name: newCategory, user_id: (await supabase.auth.getUser()).data.user.id }
                    ]);
                if (error) {
                    showMessageBox(`خطا در افزودن دسته‌بندی جدید: ${error.message}`, &#39;error&#39;);
                    return;
                }
                categories.push(newCategory);
                renderCategories();
            }
        } else if (!category) {
            showMessageBox(&#39;لطفاً یک دسته‌بندی انتخاب کنید یا دسته‌بندی جدید وارد کنید.&#39;, &#39;error&#39;);
            return;
        }

        if (isEditMode) {
            const { error } = await supabase
                .from(&#39;links&#39;)
                .update({ title, url, category, notes })
                .eq(&#39;id&#39;, links[currentLinkIndex].id)
                .eq(&#39;user_id&#39;, (await supabase.auth.getUser()).data.user.id);
            if (error) {
                showMessageBox(`خطا در ویرایش لینک: ${error.message}`, &#39;error&#39;);
                return;
            }
            showMessageBox(&#39;لینک با موفقیت ویرایش شد!&#39;, &#39;success&#39;);
        } else {
            const { error } = await supabase
                .from(&#39;links&#39;)
                .insert([
                    { title, url, category, notes, user_id: (await supabase.auth.getUser()).data.user.id }
                ]);
            if (error) {
                showMessageBox(`خطا در افزودن لینک: ${error.message}`, &#39;error&#39;);
                return;
            }
            showMessageBox(&#39;لینک با موفقیت اضافه شد!&#39;, &#39;success&#39;);
        }

        renderLinks();
        clearFormAndCloseModal();
    });

    showFormButton.addEventListener(&#39;click&#39;, () =&gt; {
        isEditMode = false;
        formModalTitle.textContent = &#39;افزودن لینک جدید&#39;;
        addLinkButton.textContent = &#39;افزودن لینک&#39;;
        clearFormAndCloseModal();
        formModal.classList.add(&#39;show&#39;);
    });

    cancelFormButton.addEventListener(&#39;click&#39;, () =&gt; {
        clearFormAndCloseModal();
    });

    function clearFormAndCloseModal() {
        titleInput.value = &#39;&#39;;
        urlInput.value = &#39;&#39;;
        categorySelect.value = &#39;&#39;;
        newCategoryInput.value = &#39;&#39;;
        notesInput.value = &#39;&#39;;
        formModal.classList.remove(&#39;show&#39;);
    }

    closeNotesModalButton.addEventListener(&#39;click&#39;, () =&gt; {
        notesModal.classList.remove(&#39;show&#39;);
    });

    saveNotesModalButton.addEventListener(&#39;click&#39;, async () =&gt; {
        if (currentLinkIndex !== -1) {
            const { error } = await supabase
                .from(&#39;links&#39;)
                .update({ notes: notesModalContent.value.trim() })
                .eq(&#39;id&#39;, links[currentLinkIndex].id)
                .eq(&#39;user_id&#39;, (await supabase.auth.getUser()).data.user.id);
            if (error) {
                showMessageBox(`خطا در ذخیره یادداشت‌ها: ${error.message}`, &#39;error&#39;);
                return;
            }
            links[currentLinkIndex].notes = notesModalContent.value.trim();
            renderLinks(searchInput.value);
            notesModal.classList.remove(&#39;show&#39;);
            showMessageBox(&#39;یادداشت‌ها با موفقیت ذخیره شد!&#39;, &#39;success&#39;);
        }
    });

    confirmDeleteBtn.addEventListener(&#39;click&#39;, async () =&gt; {
        if (currentLinkIndex !== -1) {
            const linkId = links[currentLinkIndex].id;
            const { error } = await supabase
                .from(&#39;links&#39;)
                .delete()
                .eq(&#39;id&#39;, linkId)
                .eq(&#39;user_id&#39;, (await supabase.auth.getUser()).data.user.id);
            if (error) {
                showMessageBox(`خطا در حذف لینک: ${error.message}`, &#39;error&#39;);
                return;
            }

            links = links.filter((_, i) =&gt; i !== currentLinkIndex);
            renderLinks(searchInput.value);
            confirmModal.classList.remove(&#39;show&#39;);
            showMessageBox(&#39;لینک با موفقیت حذف شد!&#39;, &#39;success&#39;);
        }
        currentLinkIndex = -1;
    });

    cancelDeleteBtn.addEventListener(&#39;click&#39;, () =&gt; {
        confirmModal.classList.remove(&#39;show&#39;);
        currentLinkIndex = -1;
    });

    searchInput.addEventListener(&#39;click&#39;, () =&gt; {
        renderLinks(searchInput.value);
    });

    searchButton.addEventListener(&#39;click&#39;, () =&gt; {
        renderLinks(searchInput.value);
    });

    function showMessageBox(message, type = &#39;info&#39;) {
        let messageBox = document.getElementById(&#39;message-box&#39;);
        if (!messageBox) {
            messageBox = document.createElement(&#39;div&#39;);
            messageBox.id = &#39;message-box&#39;;
            messageBox.className = &#39;fixed top-4 right-4 p-4 rounded-md shadow-lg text-white z-50&#39;;
            document.body.appendChild(messageBox);
        }

        messageBox.textContent = message;
        messageBox.style.display = &#39;block&#39;;

        if (type === &#39;success&#39;) {
            messageBox.style.backgroundColor = &#39;#4CAF50&#39;;
        } else if (type === &#39;error&#39;) {
            messageBox.style.backgroundColor = &#39;#f44336&#39;;
        } else {
            messageBox.style.backgroundColor = &#39;#2196F3&#39;;
        }

        setTimeout(() =&gt; {
            messageBox.style.display = &#39;none&#39;;
        }, 3000);
    }

    renderCategories();
    renderLinks();
&lt;/script&gt;
&lt;div id=&quot;message-box&quot; class=&quot;hidden&quot;&gt;&lt;/div&gt;
</code></pre>
</body>
</html>